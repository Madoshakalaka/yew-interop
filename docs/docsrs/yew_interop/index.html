<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Load On Demand"><meta name="keywords" content="rust, rustlang, rust-lang, yew_interop"><title>yew_interop - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../yew_interop/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><h2 class="location">Crate yew_interop</h2><div class="block version"><div class="narrow-helper"></div><p>Version 0.2.1</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all yew_interop's items</p></a><div class="block items"><ul><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#types">Type Definitions</a></li></ul></div><div id="sidebar-vars" data-name="yew_interop" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">yew_interop</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/yew_interop/lib.rs.html#2-93" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><div align="center"> <h1>Yew Interop</h1> <p> <strong>Load JavaScript and CSS asynchronously in Yew</strong> </p> <img alt="Crates.io" src="https://img.shields.io/crates/v/yew-interop">
<a href="https://madoshakalaka.github.io/yew-interop/v0.2.1"><img alt="demo badge released" src="https://img.shields.io/badge/demo-v0.2.1-brightgreen"/></a>
<a href="https://madoshakalaka.github.io/yew-interop/master"><img alt="demo badge master" src="https://img.shields.io/badge/demo-master-brightgreen"/></a>
<a href="https://docs.rs/yew-interop"><img alt="docs.rs" src="https://img.shields.io/badge/docs.rs-released-brightgreen"/></a>
<a href="https://madoshakalaka.github.io/yew-interop/docsrs/yew_interop/"><img alt="docs master" src="https://img.shields.io/badge/docs-master-brightgreen"/></a>
</div>
<h3 id="load-on-demand" class="section-header"><a href="#load-on-demand">Load On Demand</a></h3>
<p>With <code>yew-interop</code>, each resource is requested on demand when a consuming component requests it.</p>
<p>If you include your libraries using the
<a href="https://rustwasm.github.io/wasm-bindgen/reference/js-snippets.html">JS-snippet method with wasm-bindgen</a>
or insert them as <code>&lt;script/&gt;</code> or <code>&lt;link/&gt;</code> directly in the <code>index.html</code>,
the resources will load for every request,
even if there is no consuming component.
This can cause congestion and wasted data.</p>
<h3 id="load-once-use-everywhere" class="section-header"><a href="#load-once-use-everywhere">Load Once, Use Everywhere</a></h3>
<p>Each resource is strictly requested once.
If a resource has been requested in one component,
other consuming components won’t trigger a reload.
Other requests to the same resource will either wait for the load to complete,
or return ready immediately if the resource is loaded.</p>
<h3 id="demo" class="section-header"><a href="#demo">Demo</a></h3>
<p><a href="https://github.com/Madoshakalaka/yew-interop/tree/master/example">The example folder</a> 
has a demo website built with<code>yew-interop</code></p>
<p>The gif below shows the first two use cases,
loading speed is throttled for demo purposes.</p>
<p><img src="https://madoshakalaka.github.io/yew-interop/master/static/yew-interop-demo.gif" alt="yew interop demo gif" /></p>
<p><a href="https://madoshakalaka.github.io/yew-interop/master">Check out the full online demo</a></p>
<h2 id="install" class="section-header"><a href="#install">Install</a></h2>
<p>The master branch has the the lastest in-development code.</p>
<div class="example-wrap"><pre class="language-toml"><code>yew-interop = {git=&quot;https://github.com/Madoshakalaka/yew-interop.git&quot;, branch=&quot;master&quot;, features=[&quot;yew-stable&quot;]}</code></pre></div>
<p>The <code>yew-stable</code> feature works with the latest release of yew on crates.io, currently 0.19.<br />
If you are using yew-next (yew’s master branch), change the <code>yew-stable</code> feature to <code>yew-next</code>.</p>
<p>Or you can install the latest version published on crates.io, which uses yew 0.19.</p>
<div class="example-wrap"><pre class="language-toml"><code>yew-interop = &quot;0.2&quot;</code></pre></div>
<p>Note the <code>yew-next</code>/<code>yew-stable</code> features only exist in the master branch
since published crates can’t have git dependencies.</p>
<h2 id="api" class="section-header"><a href="#api">API</a></h2><h3 id="asynchronously-load-css-or-javascript-libraries" class="section-header"><a href="#asynchronously-load-css-or-javascript-libraries">Asynchronously Load CSS or Javascript Libraries</a></h3>
<p>If your javascript library exposes functions or objects you want to use in Rust,
then <code>yew_interop::declare_resources!</code> is the right choice.</p>
<p>First you want to create a separate module <code>interop</code> and declare your dependencies there.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// alternatively, create a separate file `interop.rs`,</span>
<span class="comment">// and add `mod interop;` to `main.rs` to have tidier code.</span>
<span class="kw">mod</span> <span class="ident">interop</span>{
    <span class="kw">use</span> <span class="ident">yew_interop::declare_resources</span>;

    <span class="macro">declare_resources!</span>(
        <span class="ident">library_a</span>
        <span class="string">&quot;https://my-cdn.com/library-a.min.js&quot;</span>
        <span class="ident">library_b</span>
        <span class="string">&quot;https://my-cdn.com/library-b.min.js&quot;</span>
        <span class="string">&quot;https://my-cdn.com/library-b.min.css&quot;</span>
        <span class="ident">library_c</span>
        <span class="string">&quot;/static/library-c.min.js&quot;</span>
        <span class="string">&quot;/static/library-c.min.css&quot;</span>
    );
}</code></pre></div>
<p>This macro expands into a <code>&lt;ResourceProvider/&gt;</code> component.
you want to wrap the root of your application in the provider:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">yew::prelude</span>::<span class="kw-2">*</span>;
<span class="kw">use</span> <span class="ident">interop::ResourceProvider</span>;

<span class="attribute">#[<span class="ident">function_component</span>(<span class="ident">App</span>)]</span>
<span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">app</span>() -&gt; <span class="ident">Html</span> {
    <span class="macro">html!</span> {
        <span class="op">&lt;</span><span class="ident">ResourceProvider</span><span class="op">&gt;</span>
            <span class="comment">// the rest of your app</span>
        <span class="op">&lt;</span><span class="op">/</span><span class="ident">ResourceProvider</span><span class="op">&gt;</span>
    }
}</code></pre></div>
<p>The macro will also expand into hooks by prepending your resource names with “<em>use</em>_”, in this case,
the macro will expand into <code>pub fn use_library_a() -&gt; bool</code> and <code>pub fn use_library_b() -&gt; bool</code></p>
<p>At your consuming component, you can use these hooks to asynchronously wait for libraries to be loaded:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>
<span class="kw">use</span> <span class="ident">yew::prelude</span>::<span class="kw-2">*</span>;
<span class="kw">use</span> <span class="ident">interop::use_library_a</span>;

<span class="attribute">#[<span class="ident">function_component</span>(<span class="ident">Consumer</span>)]</span>
<span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">consumer</span>() -&gt; <span class="ident">Html</span> {
    <span class="kw">let</span> <span class="ident">library_a_ready</span> <span class="op">=</span> <span class="ident">use_library_a</span>(); <span class="comment">// &lt;-- generated hook</span>

    <span class="macro">html!</span> {
        <span class="kw">if</span> <span class="ident">library_a_ready</span>{
            <span class="comment">// use library a here</span>
        }<span class="kw">else</span>{
            <span class="op">&lt;</span><span class="ident">p</span><span class="op">&gt;</span>{<span class="string">&quot;please wait...&quot;</span>}<span class="op">&lt;</span><span class="op">/</span><span class="ident">p</span><span class="op">&gt;</span>
        }
    }
}</code></pre></div>
<blockquote>
<p>For javascript libraries,
you will also need to write some stubs using <code>wasm-bindgen</code> and <code>js-sys</code> before using the library in Rust.
The wasm-bindgen book has <a href="https://rustwasm.github.io/wasm-bindgen/examples/import-js.html">a good chapter</a> on that.
You can also check out our demo website and have a look <a href="https://github.com/Madoshakalaka/yew-interop/blob/master/example/src/interop.rs">how it’s done there</a></p>
</blockquote>
<h3 id="explicit-resource-type" class="section-header"><a href="#explicit-resource-type">Explicit Resource Type</a></h3>
<p>The <code>declare_resources!</code> macro needs to know whether a url is JavaScript or CSS.
When you provide a string literal as in the examples above,
the macro derives the information from the suffix of the last path segment. 
It expects .js or .css and is smart enough to exclude the query params or the fragment.</p>
<p>When the path segment doesn’t end with .js or .css,
or when you provide other expressions like a macro call or an identifier,
you need to manually specify the URL type by prepending the custom keyword js/css
before the url.</p>
<p><code>declare_resources!</code> will accept any expression with a return type that implements <code>Into&lt;Cow&lt;'static, str&gt;&gt;</code>,
so <code>&amp;'static str</code>, <code>String</code>, <code>Cow&lt;'static, str&gt;</code> are all fine.</p>
<p>here’s a more complex example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">yew_interop::declare_resources</span>;

<span class="kw">const</span> <span class="ident">MY_LIB_JS</span>: <span class="kw-2">&amp;</span><span class="ident">str</span> <span class="op">=</span> <span class="string">&quot;https://cdn.com/my_lib.js&quot;</span>;

<span class="macro">declare_resources!</span>(
        <span class="ident">my_lib</span>
        <span class="ident">js</span> <span class="ident">MY_LIB_JS</span>
        <span class="string">&quot;https://cdn.com/my_lic_b.css&quot;</span> <span class="comment">// &lt;-- when a string literal is provided, script type is determined from the suffix</span>
        <span class="string">&quot;/static/snippet.js&quot;</span>
        <span class="ident">js</span> <span class="macro">concat!</span>(<span class="string">&quot;https://a.com/&quot;</span>, <span class="string">&quot;b.js&quot;</span>)
        <span class="ident">my_lib_b</span>
        <span class="ident">css</span> <span class="string">&quot;/somehow/ends/with/.js&quot;</span> <span class="comment">// &lt;-- explicit type css overrides the suffix</span>
        <span class="ident">my_lib_c</span>
        <span class="ident">js</span> <span class="ident">String::from</span>(<span class="string">&quot;https://a.com/test.js&quot;</span>)
    );
</code></pre></div>
<h3 id="side-effect-javascript" class="section-header"><a href="#side-effect-javascript">Side Effect Javascript</a></h3>
<p>Here, side effect scripts refers to the JavaScript that run something onload,
as opposed to a library that exposes functions and classes.</p>
<p>If your javascript is a side effect script, 
you want to enable the <code>script</code> feature.</p>
<div class="example-wrap"><pre class="language-toml"><code>yew-interop = {git=&quot;https://github.com/Madoshakalaka/yew-interop.git&quot;,  features=[&quot;yew-stable&quot;, &quot;script&quot;]}</code></pre></div>
<p>or</p>
<div class="example-wrap"><pre class="language-toml"><code>yew-interop = {version = &quot;0.2&quot;, features = [&quot;script&quot;]}</code></pre></div>
<p>You will need to prepend the identifier of a script with an exclamation mark (!).
And only one script url for each identifier, here’s an example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">yew_interop::declare_resources</span>;

<span class="macro">declare_resources!</span>(
    <span class="ident">lib</span> <span class="comment">// &lt;- normal library</span>
    <span class="string">&quot;https://cdn.com/lib.js&quot;</span>
    <span class="string">&quot;/static/lib.css&quot;</span>
    <span class="op">!</span> <span class="ident">my_script</span> <span class="comment">// &lt;- exclamation mark for side effect scripts</span>
    <span class="string">&quot;https://cdn.com/script.js&quot;</span>
);</code></pre></div>
<p>You never need to specify the resource type explicitly, 
since only JavaScript is allowed.</p>
<p>Same as previous examples, this will expand into a <code>use_&lt;identifier&gt;</code> hook.
What’s different is that instead of a bool,
the hook returns an <code>Option&lt;Script&gt;</code>,
it is none when the script is loading.</p>
<p>To run the script, you will need to render a <code>&lt;ScriptEffect/&gt;</code> component.
This allows you to freely control whether and when the script should be run.
The <code>&lt;ScriptEffect/&gt;</code> component is a <a href="https://yew.rs/docs/next/advanced-topics/portals">portal</a>
to the <code>&lt;head/&gt;</code> element of the document,
so it won’t render anything in its place,
it will only run the script on render.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>
<span class="kw">mod</span> <span class="ident">interop</span>{
    <span class="kw">use</span> <span class="ident">yew_interop::declare_resources</span>;
    <span class="macro">declare_resources!</span>(
        <span class="op">!</span> <span class="ident">my_script</span>
        <span class="string">&quot;https://cdn.com/script.js&quot;</span>
    );
}

<span class="kw">use</span> <span class="ident">yew::prelude</span>::<span class="kw-2">*</span>;
<span class="kw">use</span> <span class="ident">yew_interop::ScriptEffect</span>;
<span class="kw">use</span> <span class="ident">interop::use_my_script</span>; <span class="comment">// &lt;-- generated hook</span>

<span class="doccomment">/// this example simply runs the script on every re-render, if the script is ready.</span>
<span class="attribute">#[<span class="ident">function_component</span>(<span class="ident">MyComp</span>)]</span>
<span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">my_comp</span>() -&gt; <span class="ident">Html</span> {
    <span class="kw">let</span> <span class="ident">script</span> <span class="op">=</span> <span class="ident">use_my_script</span>();
    
    <span class="comment">// ...snip</span>
    
    <span class="macro">html!</span> {
        <span class="kw">if</span> <span class="ident">script</span>.<span class="ident">is_none</span>(){
            <span class="op">&lt;</span><span class="ident">p</span><span class="op">&gt;</span>{<span class="string">&quot;Please wait...&quot;</span>}<span class="op">&lt;</span><span class="op">/</span><span class="ident">p</span><span class="op">&gt;</span>
        }<span class="kw">else</span>{
            <span class="op">&lt;</span><span class="ident">p</span><span class="op">&gt;</span>{<span class="string">&quot;Script Completed!&quot;</span>}<span class="op">&lt;</span><span class="op">/</span><span class="ident">p</span><span class="op">&gt;</span>
            <span class="op">&lt;</span><span class="ident">ScriptEffect</span> {<span class="ident">script</span>}<span class="op">/</span><span class="op">&gt;</span>
        }
    }
}</code></pre></div>
<p>If your script depends on other components being rendered,
such as the fourth example <a href="https://madoshakalaka.github.io/yew-interop/master/">in the demo</a>,
where the script adds onclick handlers to the rendered elements,
you will need to guarantee the script is rendered after all the dependees.</p>
<p>Yew renders descendents in a breadth-first order from bottom to top,
which is not the most intuitive rendering order.</p>
<p>One way to guarantee the correct rendering order is to
place the <code>&lt;ScriptEffect/&gt;</code> component as a <strong>sibling on top of the deepest dependees</strong>,</p>
<p>For example, let’s say your script depends on two components <code>&lt;ComponentA/&gt;</code> and <code>&lt;ComponentB/&gt;</code>.</p>
<p>The case below shows a correct placement where A and B has the same depth,
the rendering order here is B -&gt; A -&gt; ScriptEffect</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>    <span class="macro">html!</span>{
        <span class="op">&lt;</span><span class="op">&gt;</span>
        <span class="op">&lt;</span><span class="ident">ScriptEffect</span> {<span class="ident">script</span>}<span class="op">/</span><span class="op">&gt;</span>
        <span class="op">&lt;</span><span class="ident">ComponentA</span><span class="op">/</span><span class="op">&gt;</span>
        <span class="op">&lt;</span><span class="ident">ComponentB</span><span class="op">/</span><span class="op">&gt;</span>
        <span class="comment">// &lt;ScriptEffect {script}/&gt; !!! do not place here, otherwise it would render first</span>
        <span class="op">&lt;</span><span class="op">/</span><span class="op">&gt;</span>
    }</code></pre></div>
<p>Here’s trickier one, where B is deeper, so we place our component on top of B:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Properties</span>, <span class="ident">PartialEq</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">ContainerProps</span> {
    <span class="ident">children</span>: <span class="ident">Children</span>
}

<span class="attribute">#[<span class="ident">function_component</span>(<span class="ident">Container</span>)]</span>
<span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">container</span>(<span class="ident">props</span>: <span class="kw-2">&amp;</span><span class="ident">ContainerProps</span>) -&gt; <span class="ident">Html</span> {
    <span class="comment">// --snip--</span>
    <span class="macro">html!</span> {
        {<span class="kw">for</span> <span class="ident">props</span>.<span class="ident">children</span>.<span class="ident">iter</span>()}
    }
}

    <span class="macro">html!</span>{
        <span class="op">&lt;</span><span class="op">&gt;</span>
        <span class="op">&lt;</span><span class="ident">ComponentA</span><span class="op">/</span><span class="op">&gt;</span>
        <span class="op">&lt;</span><span class="ident">Container</span><span class="op">&gt;</span>
            <span class="op">&lt;</span><span class="ident">ScriptEffect</span> {<span class="ident">script</span>}<span class="op">/</span><span class="op">&gt;</span>
            <span class="op">&lt;</span><span class="ident">ComponentB</span><span class="op">/</span><span class="op">&gt;</span>
        <span class="op">&lt;</span><span class="op">/</span><span class="ident">Container</span><span class="op">&gt;</span>
        <span class="op">&lt;</span><span class="ident">ComponentC</span><span class="op">/</span><span class="op">&gt;</span>
        <span class="op">&lt;</span><span class="op">/</span><span class="op">&gt;</span>
    }</code></pre></div>
<p>The rendering order is C -&gt; Container -&gt; A -&gt; B -&gt; ScriptEffect.</p>
<h2 id="contributing" class="section-header"><a href="#contributing">Contributing</a></h2>
<p>Your PR on <a href="https://github.com/Madoshakalaka/yew-interop">GitHub</a> is welcome!
There is very extensive testing in CI.
Be sure to check out our <a href="https://github.com/Madoshakalaka/yew-interop/blob/master/CONTRIBUTING.md">development guide</a>.</p>
</div></details><h2 id="macros" class="section-header"><a href="#macros">Macros</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="macro" href="macro.declare_resources.html" title="yew_interop::declare_resources macro">declare_resources</a></div><div class="item-right docblock-short"><p>Declare your libraries as whitespace separated groups of identifier
and one or more urls</p>
</div></div></div><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ScriptEffectProps.html" title="yew_interop::ScriptEffectProps struct">ScriptEffectProps</a></div><div class="item-right docblock-short"><p>If the script attribute is None, the component does nothing.</p>
</div></div></div><h2 id="types" class="section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.ScriptEffect.html" title="yew_interop::ScriptEffect type">ScriptEffect</a></div><div class="item-right docblock-short"><p>This component runs javascript <strong>on render</strong>.
Note this is different from the [<code>yew::use_effect</code>] hook, which runs <strong>after rendering</strong>.</p>
</div></div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="yew_interop" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
    <script src="../main.js"></script>
</body></html>